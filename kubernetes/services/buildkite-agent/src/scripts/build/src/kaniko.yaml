---
apiVersion: v1
kind: Pod
metadata:
  name: kaniko
spec:
  containers:
    - name: kaniko
      image: gcr.io/kaniko-project/executor:latest
      imagePullPolicy: IfNotPresent
      args:
        - "--dockerfile=<path to Dockerfile within the build context>"
        - "--context=."
        - "--destination=<gcr.io/$PROJECT/$IMAGE:$TAG>"
      volumeMounts:
        - name: kaniko-secret
          mountPath: /secret
      envFrom:
        - secretRef:
            name: kaniko-env
      resources:
        limits:
          cpu: 1
          memory: 2Gi
        requests:
          cpu: 1
          memory: 516Mi
      securityContext:
        runAsUser: 0
        runAsGroup: 0
        privileged: false
  serviceAccountName: sa-kaniko
  restartPolicy: Never